# Trigger Bot

Telegram-бот для управления пользовательскими триггерами в чатах. Позволяет пользователям задавать ключевые фразы и соответствующие ответы (текст, изображения, стикеры и т.д.).

## Возможности

*   **Создание триггеров**: Настройка триггеров с текстом, фото, стикерами, анимацией и т.д.
*   **Типы совпадений**: Точное совпадение, Содержит, Регулярное выражение.
*   **Контроль доступа**: Настройка того, кто может добавлять триггеры (все или только администраторы).
*   **Управление**: Список, удаление и управление триггерами через команды и инлайн-интерфейс.
*   **Интернационализация**: Поддержка нескольких языков (Английский, Русский).
*   **Кэширование**: Высокая производительность благодаря кэшированию Valkey (Redis).

## Установка

### Требования

*   Установленные Docker и Docker Compose.
*   Токен Telegram-бота (от @BotFather).

### Инструкция по установке

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository_url>
    cd trigger
    ```

2.  **Переменные окружения:**
    Вы можете задать переменные окружения в файле `.env` или напрямую в `docker-compose.yml`.
    
    Обязательные переменные:
    *   `BOT_TOKEN`: Ваш токен Telegram-бота.
    
    Необязательные переменные (значения по умолчанию указаны в `docker-compose.yml`):
    *   `POSTGRES_URL`: Строка подключения к базе данных.
    *   `VALKEY_URL`: Строка подключения к Valkey/Redis.
    *   `WEBHOOK_PATH`: Путь для вебхука (по умолчанию: `/webhook`).
    *   `SECRET_TOKEN`: Секретный токен для безопасности вебхука.

3.  **Запустите сервисы:**
    ```bash
    docker-compose up -d --build
    ```

4.  **Запустите миграции базы данных:**
    Примените схему базы данных:
    ```bash
    docker-compose exec bot alembic upgrade head
    ```

## Использование

### Команды

*   `/trigger <key>` - Запустить мастер создания триггера для указанной ключевой фразы.
*   `/list` - Показать список всех триггеров в текущем чате.
*   `/del <key>` - Удалить конкретный триггер по его ключевой фразе.
*   `/lang` - Изменить язык бота (Русский/Английский).
*   `/settings` - Открыть меню настроек (только для администраторов).

### Настройки

*   **Admins Only Add**: Переключить режим, когда только администраторы могут создавать триггеры.
*   **Clear All Triggers**: Удалить все триггеры в чате (требуется подтверждение).

## Разработка

*   **Язык**: Python 3.13+
*   **Фреймворк**: Aiogram 3.x
*   **База данных**: PostgreSQL + SQLAlchemy (Async)
*   **Кэш**: Valkey (Redis compatible)
*   **Линтинг**: Ruff
*   **Управление зависимостями**: uv

Для локального запуска без Docker (требуется запущенные экземпляры Postgres и Redis):
```bash
# Установка зависимостей
uv sync

# Запуск бота
uv run uvicorn app.main:app --reload
```
